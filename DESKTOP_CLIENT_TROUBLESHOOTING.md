# מדריך פתרון בעיות Desktop Client - Digitlex

## בעיות שתוקנו

### 1. תיקון כתובת שרת
- ✅ שונה מ-`127.0.0.1:3001` ל-`localhost:3001`
- ✅ הוספת יכולת שינוי כתובת שרת מתפריט הניהול
- ✅ שיפור טעינת קבצי מדיה מהשרת

### 2. שיפור תפריט הניהול
- ✅ תפריט ניהול משופר (לחץ F8)
- ✅ בדיקת חיבור משופרת
- ✅ אפשרות שינוי כתובת שרת בזמן אמת

### 3. שיפור טעינת תמונות
- ✅ fallback אוטומטי לטעינה מהשרת אם קובץ מקומי נכשל
- ✅ הודעות שגיאה ברורות יותר

## איך להפעיל את ה-Desktop Client

### שלב 1: ודא שהשרת רץ
```bash
# מתיקיית הפרויקט
start-server.bat
# או ידנית:
cd server
node index.js
```

### שלב 2: הפעל את ה-Desktop Client
```bash
# מתיקיית הפרויקט
cd desktop-client
start-desktop.bat
# או ידנית:
npm start
```

### שלב 3: הגדר מזהה מסך
1. במסך הפתיחה, הזן מזהה מסך (לדוגמה: `test123`)
2. לחץ "שמור מזהה מסך"
3. המסך יתחיל להתחבר לשרת ולהציג תוכן

## שימוש בתפריט הניהול (F8)

1. **פתיחת התפריט**: לחץ `F8` כדי לפתוח את תפריט הניהול
2. **שינוי כתובת שרת**: הזן כתובת שרת חדשה (לדוגמה: `http://192.168.1.100:3001`)
3. **בדיקת חיבור**: לחץ "בדוק חיבור" לבדיקה אם השרת זמין
4. **שמירת הגדרות**: לחץ "שמור הגדרות" ולאחר מכן "הפעל מחדש"

## בדיקת חיבור מהטרמינל

```bash
# מתיקיית הפרויקט
node test-desktop-connection.js
```

הסקריפט יבדוק:
- ✅ Health check
- ✅ יצירת מסך
- ✅ Heartbeat
- ✅ תוכן ציבורי
- ✅ RSS
- ✅ הודעות

## פתרון בעיות נפוצות

### "לא מצליח להתחבר לשרת"

1. **בדוק שהשרת רץ**:
   ```bash
   netstat -an | findstr 3001
   # אמור להראות: TCP 0.0.0.0:3001 ... LISTENING
   ```

2. **בדוק כתובת שרת**:
   - לחץ F8 בdesktop client
   - ודא שכתובת השרת נכונה: `http://localhost:3001`
   - לחץ "בדוק חיבור"

3. **בדוק חסימת Firewall**:
   - Windows Defender Firewall עלול לחסום
   - הוסף חריגה לפורט 3001

### "תמונות לא נטענות"

1. **בדוק נתיב קבצים**:
   - ודא שקבצי התמונות קיימים בתיקיית `server/uploads/`
   - בדוק שהשרת משרת קבצים מ-`/uploads`

2. **בדוק רשאות**:
   - ודא שלתיקיית `server/uploads/` יש רשאות קריאה

3. **debugging**:
   - פתח Developer Tools (Ctrl+Shift+I)
   - בדוק שגיאות ברשויותת Console

### "Heartbeat נכשל"

1. **בדוק מזהה מסך**:
   - ודא שמזהה המסך נשמר (F8 → בדוק מזהה)
   - נסה מזהה חדש

2. **בדוק לוגים של השרת**:
   - האם מגיעים heartbeat requests?
   - יש שגיאות בטרמינל השרת?

### "אין תוכן להצגה"

1. **הוסף תוכן דרך פאנל הניהול**:
   - פתח http://localhost:3000
   - התחבר עם admin/admin123
   - צור מסך חדש או הוסף תוכן למסך קיים

2. **בדוק מזהה מסך**:
   - ודא שמזהה המסך ב-desktop client תואם למזהה בפאנל הניהול

## מקשי קיצור בdesktop client

| מקש | פעולה |
|-----|-------|
| F8 | תפריט ניהול |
| ESC | יציאה |
| F11 | מסך מלא (במצב פיתוח) |
| Ctrl+Q | יציאה מהירה |

## קבצים שהשתנו

### Desktop Client
- `desktop-client/src/main.js` - תיקון כתובת שרת
- `desktop-client/src/renderer.js` - שיפור תפריט ניהול וטעינת תמונות
- `desktop-client/start-desktop.bat` - סקריפט הפעלה נוח

### שרת
- `server/index.js` - שיפור לוגים של heartbeat

### כלי עזר
- `test-desktop-connection.js` - כלי בדיקת חיבור
- `DESKTOP_CLIENT_TROUBLESHOOTING.md` - המדריך הזה

## מבנה קבצי Desktop Client

```
desktop-client/
├── src/
│   ├── main.js          # תהליך ראשי של Electron
│   ├── renderer.js      # לוגיקת הממשק
│   └── index.html       # ממשק המשתמש
├── assets/
│   └── icon.png         # אייקון האפליקציה
├── package.json         # הגדרות הפרויקט
└── start-desktop.bat    # סקריפט הפעלה
```

## הערות מפתחים

1. **מצב פיתוח**: קבע `NODE_ENV=development` למצב פיתוח
2. **לוגים**: כל הפעילות נרשמת בקונסול
3. **אחסון מקומי**: הגדרות נשמרות ב-electron-store
4. **עדכונים אוטומטיים**: מופעלים רק בגרסת production

אם הבעיה עדיין קיימת, בדוק את הקונסול בדפדפן ואת הלוגים בטרמינל השרת.
